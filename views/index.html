<!DOCTYPE html>
<html style="background-color:#222222; color:#FFFFFF;">
	<head> <!-- ####################################################### Inicializaciones y CSS ####################################################### -->
        <meta charset="UTF-8" />
        <link rel="icon" href="https://i.imgur.com/I8ju6wN.png">
        <title>Tales of Raziel Lewach</title>
        <script src="https://code.jquery.com/jquery-latest.min.js"></script>
		
		<style>
			/* Style the tab */
			.tab {
				overflow: hidden;
				border: 1px solid #ccc;
				background-color: #f1f1f1;
			}

			/* Style the buttons inside the tab */
			.tab button {
				background-color: inherit;
				float: left;
				border: none;
				outline: none;
				cursor: pointer;
				padding: 14px 16px;
				transition: 0.3s;
				font-size: 17px;
			}

			/* Change background color of buttons on hover */
			.tab button:hover {
				background-color: #ddd;
			}

			/* Create an active/current tablink class */
			.tab button.active {
				background-color: #ccc;
			}

			/* Style the tab content */
			.tabcontent {
				display: none;
				border: 1px solid #ccc;
				border-top: none;
			}
			
			#game {
				border: 2px solid #FFFFFF;
				background-color: #000000;
			}
			
			/* Colores para los capítulos.*/
			.title {
				text-align:center;
				font-weight: bold;
				font-size: 20px;
			}
			
			#chapter {
				color: #FFFFFF;
				background-color: #000000;
				border: 2px solid #FFFFFF;
				padding: 5px;
				line-height: 20px;
			}
			
			.colNPC {
				color: #888888;
			}
			
			/* Tabla de acciones */
			.tdAcc {
				width: 200px;
			}
			
			.btnAccion {
				margin: 2px;
			}
			
			ul {
				list-style: none;
			}
			
			.liInvisible {
				width: 0px;
				overflow: hidden;
			}
			
			#lisVisualField {
				overflow: hidden;
			}
		</style>
	</head>
	<body style="font-family: 'verdana';">
		<div> <!-- ####################################################### El HTML que forma todo ####################################################### -->
			<table><tr><td>TALES OF RAZIEL LEWACH</td></tr>
			<tr><td><label for="name">Name:</label><input id="name" type="text"></input></td>
			<td><label for="pass">Password:</label><input id="pass" type="text"></input></td>
			<td><p id="msgSesion">Account not started. Create a new user or enter your existing user!</p></td></tr></table>
			
			<div id="content" style="display: none;">
				<div class="tab">
					<button class="tablinks" onclick="openTale(event, 'tale01')">Humano, Sangre y petróleo</button>
				</div>

				<div id="tale01" class="tabcontent">
					<table><tr><td style="border-right: 2px solid white;"><label for="charname01">Character name:</label><input id="charname01" type="text"></input><button id="bt01m">&#9794 </button><button id="bt01f">&#9792 </button></td><td id="tdColor01" style="border-right: 2px solid white;"><font style="color: #000000;">Color:</font> <input id="sl01" type="range" min="0" max="255" value="0" style="outline: 2px solid #000000;"></td><td>Chapters:</td><td><button id="bt01e01">1</button></td><td><button id="bt01e02">2</button></td></tr></table>
				</div>
				
				<br>
				<div id="chapter" style="display: none;"></div>
			</div>
			
			<br>
			<div id="game" style="display: none; height: 670px">
				<table>
					<tr>
						<td style="width:300px;"> <!-- La imagen del PJ-->
							<img src="https://preview.redd.it/cwso6msrejj01.jpg?width=640&crop=smart&auto=webp&s=b5ade9302ff40165a35284f9073c670cea31f4a7" width="300">
						</td>
						<td>
							<!-- Los datos a mostrar-->
							<ul id="lisVisualField"></ul>
							<br>
							
							<!-- Los stats. -->
							<table>
								<tr> <!-- Categorías -->
									<td class="tdAcc"></td><td class="tdAcc">MENTE (cabeza)</td><td class="tdAcc">FÍSICO (cuerpo)</td><td class="tdAcc">SIGILO (brazos)</td><td class="tdAcc">AGILIDAD (piernas)</td>
								</tr>
								<tr> <!-- Stats ofensivos -->
									<td>
										OFENSIVOS
									</td><td>
										<input type="radio" id="rbInteligenciaPlayer" name="offensiveStat" value="inteligenciaPlayer" class="rbChoose">
										<label for="rbInteligenciaPlayer" id="lbInteligenciaPlayer">Inteligencia</label>
									</td><td>
										<input type="radio" id="rbFuerzaPlayer" name="offensiveStat" value="fuerzaPlayer" class="rbChoose">
										<label for="rbFuerzaPlayer" id="lbFuerzaPlayer">Fuerza</label>
									</td><td>
										<input type="radio" id="rbPercepcionPlayer" name="offensiveStat" value="percepcionPlayer" class="rbChoose">
										<label for="rbPercepcionPlayer" id="lbPercepcionPlayer">Percepción</label>
									</td><td>
										<input type="radio" id="rbPrecisionPlayer" name="offensiveStat" value="precisionPlayer" class="rbChoose">
										<label for="rbPrecisionPlayer" id="lbPrecisionPlayer">Precisión</label>
									</td>
								</tr>
								<tr> <!-- Stats defensivos -->
									<td>
										DEFENSIVOS
									</td><td>
										<input type="radio" id="rbVoluntadPlayer" name="deffensiveStat" value="voluntadPlayer" class="rbChoose">
										<label for="rbVoluntadPlayer" id="lbVoluntadPlayer">Voluntad</label>
									</td><td>
										<input type="radio" id="rbResistenciaPlayer" name="deffensiveStat" value="resistenciaPlayer" class="rbChoose">
										<label for="rbResistenciaPlayer" id="lbResistenciaPlayer">Resistencia</label>
									</td><td>
										<input type="radio" id="rbCamuflajePlayer" name="deffensiveStat" value="camuflajePlayer" class="rbChoose">
										<label for="rbCamuflajePlayer" id="lbCamuflajePlayer">Camuflaje</label>
									</td><td>
										<input type="radio" id="rbReflejosPlayer" name="deffensiveStat" value="reflejosPlayer" class="rbChoose">
										<label for="rbReflejosPlayer" id="lbReflejosPlayer">Reflejos</label>
									</td>
								</tr>
							</table>
							<br>
							
							<!-- Las acciones -->
							<button id="btAtacarCabeza" class="btnAccion" disabled>Atacar a cabeza</button>
							<button id="btAtacarCuerpo" class="btnAccion" disabled>Atacar a cuerpo</button>
							<button id="btAtacarBrazos" class="btnAccion" disabled>Atacar a brazos</button>
							<button id="btAtacarPiernas" class="btnAccion" disabled>Atacar a piernas</button>
							<button id="btRecolectar" class="btnAccion" disabled>Recolectar</button>
							<button id="btManipular" class="btnAccion" disabled>Manipular</button>
						</td>
					</tr>
				</table>
				
				
			</div>
		</div>
		<script src="/socket.io/socket.io.js"></script>
		<script>
			if (true){ // ####################################################### Inicializaciones. #######################################################
				// Variables de estado.
				var socket = io();
				var name = ""; // Nombre de usuario para chequear en el momento. Sólo se setea tras logins exitosos, pero aun así comprobar en cada acceso por si lo modifican con hacks.
				var pass = ""; // Contraseña guardada con la que te registraste o iniciaste sesión.
				var currentCharacterName = ""; // Nombre actual del personaje actual de la tale seleccionada.
				var currentCharacterGender = ""; // El género actual pos.
				var currentCharacterColor = ""; // Pos el color.
				var currentTale = 00; // ¿Qué tale andas viendo?
				var currentChapter = 00; // ¿Qué episodio andas viendo?
				var chosenObjective = ""; // ¿Sobre qué actúas?
				var chosenOffensive = ""; // ¿Cómo actúas ofensivamente?
				var chosenDefensive = ""; // ¿Cómo actúas defensivamente?
				var heightPercentageLis = 0; // El porcentaje de altura para verlo gradual en listas con elementos.
				var alphaElement = 0; // Pos eso.
			}
			if (true){ // ####################################################### Login. #######################################################
				// Envia las señales del login.
				$("#name").keypress((e) => {
					if (e.key == "Enter") login();
				});
				$("#pass").keypress((e) => {
					if (e.key == "Enter") login();
				});
				
				function login()
				{
					socket.emit("login",$("#name").val(),$("#pass").val());
					resetChapter();
				}
				
				// Recibe las señales del login.
				socket.on("newUserSuccess", (_name,_pass) => {
					name = _name;
					pass = _pass;
					$("#msgSesion").text("Welcome to your account, "+String(name)+"!");
					$("#content").css("display","inline");
					resetTales();
				});
				socket.on("newUserFail", () => {
					$("#msgSesion").text("Wrong password for that account!");
					name = "";
					pass = "";
					$("#content").css("display","none");
					resetTales();
				});
			}
			if (true){ // ####################################################### Sistema de tabs, tales y chapters. #######################################################
				// Maneja los tabs de las tales.
				function openTale(_evt,_taleName) {
					resetTales();
					document.getElementById(_taleName).style.display = "block";
					_evt.currentTarget.className += " active";
					resetChapter();
					currentCharacterName = "";
					currentCharacterGender = "";
					currentCharacterColor = "";
					
					// Actualiza el character name que toca.
					if (_taleName == "tale01") socket.emit("demandCharacterData",name,pass,"01");
				}
				
				// Resetea las tales.
				function resetTales()
				{
					var i, tabcontent, tablinks;
					tabcontent = document.getElementsByClassName("tabcontent");
					for (i = 0; i < tabcontent.length; i++) {
						tabcontent[i].style.display = "none";
					}
					tablinks = document.getElementsByClassName("tablinks");
					for (i = 0; i < tablinks.length; i++) {
						tablinks[i].className = tablinks[i].className.replace(" active", "");
					}
				}
				
				// Muestra cada episodio.
				setChapterListener("01","01");
				setChapterListener("01","02");
				
				// La lógica y el chequeo a base de datos si tenemos acceso a ese episodio.
				function setChapterListener(_tale,_chapter)
				{
					$("#bt"+String(_tale)+"e"+String(_chapter)).click((e) => {
						// Al clicar el botón, comprobamos que el usuario tiene acceso al chapter de esa tale y el servidor nos manda la información.
						socket.emit("loadChapter",name,pass,_tale,_chapter,currentCharacterName,currentCharacterGender,currentCharacterColor);
						currentTale = _tale;
						currentChapter = _chapter;
					});
				}
				
				// Recibe las señales de comprobar chapter y cargar contenido.
				socket.on("chapterSuccess", (_content) => {
					$("#chapter").html(_content);
					$("#chapter").css("display","block");
					$("#game").css("display","block");
					
					// Al cargar el capítulo, carga los datos del minijuego asociado.
					socket.emit("loop" + String(currentTale),name,pass,currentTale,currentChapter,"");
				});
				socket.on("chapterFail", () => {
					$("#chapter").html("Tale's chapter not unlocked!");
					$("#chapter").css("display","block");
					$("#game").css("display","none");
				});
			
				function resetChapter()
				{
					$("#chapter").html("");
					$("#chapter").css("display","none");
					$("#game").css("display","none");
					currentTale = 00;
					currentChapter = 00;
				}
			}
			if (true){ // ####################################################### Gestiona los datos de tu personaje. #######################################################
				// Recibe el nombre actualizado.
				socket.on("characterNameChanged", (_character) => {
					currentCharacterName = _character;
				});
				
				// Recibe el género actualizado.
				socket.on("characterGenderChanged", (_gender) => {
					currentCharacterGender = _gender;
				});
				
				// Recibe el color actualizado.
				socket.on("characterColorChanged", (_color) => {
					currentCharacterColor = _color;
				});
				
				// Carga el character name y gender al elegir una pestaña.
				socket.on("receiveCharacterData", (_tale,_character,_gender,_color) => {
					currentCharacterName = _character;
					currentCharacterGender = _gender;
					currentCharacterColor = _color;
					$("#charname"+String(_tale)).val(_character);
					$("#tdColor"+String(_tale)).css("background-color","hsl("+String(_color)+" 100% 50%)");
					$("#sl"+String(_tale)).val(_color);
				});
			}
			if (true){ // ####################################################### Setea los datos de tu personaje para la tale 01. #######################################################
				// Setea el nombre de tu personaje, el género y el color.
				setCharacterListener("01");
				
				// La lógica del seteo de nombre.
				function setCharacterListener(_tale)
				{
					// Nombre.
					$("#charname"+String(_tale)).keypress((e) => {
						if (e.key == "Enter")
						{
							socket.emit("setCharacterName",name,pass,_tale,$("#charname"+String(_tale)).val());
							resetChapter();
						}
					});
					
					// Género masculino o neutro.
					$("#bt"+String(_tale)+"m").click((e) => {
						socket.emit("setCharacterName",name,pass,_tale,$("#charname"+String(_tale)).val());
						socket.emit("setCharacterGender",name,pass,_tale,"M");
						resetChapter();
					});
					
					// Género femenino.
					$("#bt"+String(_tale)+"f").click((e) => {
						socket.emit("setCharacterName",name,pass,_tale,$("#charname"+String(_tale)).val());
						socket.emit("setCharacterGender",name,pass,_tale,"F");
						resetChapter();
					});
					
					// Color.
					$("#sl"+String(_tale)).on("change", function() {
						socket.emit("setCharacterName",name,pass,_tale,$("#charname"+String(_tale)).val());
						socket.emit("setCharacterColor",name,pass,_tale,$(this).val());
						resetChapter();
						$("#tdColor"+String(_tale)).css("background-color","hsl("+String($(this).val())+" 100% 50%)");
					});
					$("#sl"+String(_tale)).on("mousemove", function() {
						$("#tdColor"+String(_tale)).css("background-color","hsl("+String($(this).val())+" 100% 50%)");
					});
				}
			}
			if (true){ // ####################################################### Tale 01: Lógica. #######################################################
				// Varios botones con los que interactuar y enviar el loop al servidor.
				$("#btAtacarCabeza").click((e) => {
					socketEmitLoop01("clickAtacar/la cabeza/"+String(chosenObjective)+"/"+String(chosenOffensive)+"/"+String(chosenDefensive));
				});
				$("#btAtacarCuerpo").click((e) => {
					socketEmitLoop01("clickAtacar/el cuerpo/"+String(chosenObjective)+"/"+String(chosenOffensive)+"/"+String(chosenDefensive));
				});
				$("#btAtacarBrazos").click((e) => {
					socketEmitLoop01("clickAtacar/los brazos/"+String(chosenObjective)+"/"+String(chosenOffensive)+"/"+String(chosenDefensive));
				});
				$("#btAtacarPiernas").click((e) => {
					socketEmitLoop01("clickAtacar/las piernas/"+String(chosenObjective)+"/"+String(chosenOffensive)+"/"+String(chosenDefensive));
				});
				$("#btRecolectar").click((e) => {
					socketEmitLoop01("clickRecolectar");
				});
				$("#btManipular").click((e) => {
					socketEmitLoop01("clickManipular");
				});
				
				setInterval(() => {
					// Si has enviado un comando y la lista de roles se va a cerrar, va eliminando sus carácters.
					alphaElement = tiendeAX(alphaElement,1*($("#lisVisualField").hasClass("lisOpened")),0.01);
					$("#lisVisualField").css("opacity",alphaElement);
				},16);
				
				function socketEmitLoop01(_accion)
				{
					setTimeout(() => {
						socket.emit("loop01",name,pass,currentTale,currentChapter,_accion);
					},2000);
					$(".btnAccion").attr("disabled","true");
					$(".rbChoose").attr('checked',false);
					$(".rbChoose").attr('disabled',"true");
					$("#lisVisualField").removeClass("lisOpened");
					chosenObjective = "";
					chosenOffensive = "";
					chosenDefensive = "";
				}
				
				$("#rbFuerzaPlayer").change(_event => {
					chosenOffensive = "fuerza";
					enableAction();
				});
				$("#rbPrecisionPlayer").change(_event => {
					chosenOffensive = "precision";
					enableAction();
				});
				$("#rbPercepcionPlayer").change(_event => {
					chosenOffensive = "percepcion";
					enableAction();
				});
				$("#rbInteligenciaPlayer").change(_event => {
					chosenOffensive = "inteligencia";
					enableAction();
				});
				$("#rbResistenciaPlayer").change(_event => {
					chosenDefensive = "resistencia";
					enableAction();
				});
				$("#rbReflejosPlayer").change(_event => {
					chosenDefensive = "reflejos";
					enableAction();
				});
				$("#rbCamuflajePlayer").change(_event => {
					chosenDefensive = "camuflaje";
					enableAction();
				});
				$("#rbVoluntadPlayer").change(_event => {
					chosenDefensive = "voluntad";
					enableAction();
				});
				
				function enableAction()
				{
					if (chosenObjective != "" && chosenOffensive != "" && chosenDefensive != "")
					{
						$(".btnAccion").removeAttr("disabled");
					}
				}
				
				// Recibe el loop del servidor y actualiza tu ventana.
				socket.on("looped01", (_dataPlayer,_dataEnemies,_ret) => {					
					// Actualiza qué hay en la sala.
					$("#lisVisualField").empty();
					
					// Setea los parámetros.
					$("#lbFuerzaPlayer").text("[" + String(Math.round(_dataPlayer.fuerzaPlayer*(1-0.2*_dataPlayer.heridasCuerpoPlayer)))+"] Fuerza");
					$("#lbResistenciaPlayer").text("[" + String(Math.round(_dataPlayer.resistenciaPlayer*(1-0.2*_dataPlayer.heridasCuerpoPlayer)))+"] Resistencia");
					$("#lbPrecisionPlayer").text("[" + String(Math.round(_dataPlayer.precisionPlayer*(1-0.2*_dataPlayer.heridasPiernasPlayer)))+"] Precisión");
					$("#lbReflejosPlayer").text("[" + String(Math.round(_dataPlayer.reflejosPlayer*(1-0.2*_dataPlayer.heridasPiernasPlayer)))+"] Reflejos");
					$("#lbPercepcionPlayer").text("[" + String(Math.round(_dataPlayer.percepcionPlayer*(1-0.2*_dataPlayer.heridasBrazosPlayer)))+"] Percepción");
					$("#lbCamuflajePlayer").text("[" + String(Math.round(_dataPlayer.camuflajePlayer*(1-0.2*_dataPlayer.heridasBrazosPlayer)))+"] Camuflaje");
					$("#lbInteligenciaPlayer").text("[" + String(Math.round(_dataPlayer.inteligenciaPlayer*(1-0.2*_dataPlayer.heridasCabezaPlayer)))+"] Inteligencia");
					$("#lbVoluntadPlayer").text("[" + String(Math.round(_dataPlayer.voluntadPlayer*(1-0.2*_dataPlayer.heridasCabezaPlayer)))+"] Voluntad");
					
					// El resultado del turno procesado.
					_ret.forEach(_e => {
						$("#lisVisualField").append("<li>- "+String(_e)+"</li>");
						$("#lisVisualField").append("<li class='liInvisible'>.</li>");
					});
					
					// Las posibles heridas de tu cuerpo.
					if (_dataPlayer.heridasCabezaPlayer+_dataPlayer.heridasBrazosPlayer+_dataPlayer.heridasCuerpoPlayer+_dataPlayer.heridasPiernasPlayer == 0)
						$("#lisVisualField").append("<li>- Te sientes en perfecto estado.</li>");
					let _txtPartes = "";
					if (_dataPlayer.heridasCabezaPlayer > 0)
						_txtPartes += "Tu cabeza está " + String(_dataPlayer.heridasCabezaPlayer == 1 ? "herida levemente. " : (_dataPlayer.heridasCabezaPlayer == 2 ? "herida gravemente. " : "herida críticamente. "));
					if (_dataPlayer.heridasCuerpoPlayer > 0)
						_txtPartes += "Tu cuerpo está " + String(_dataPlayer.heridasCuerpoPlayer == 1 ? "herido levemente. " : (_dataPlayer.heridasCuerpoPlayer == 2 ? "herido gravemente. " : "herido críticamente. "));
					if (_dataPlayer.heridasBrazosPlayer > 0)
						_txtPartes += "Tus brazos están " + String(_dataPlayer.heridasBrazosPlayer == 1 ? "heridos levemente. " : (_dataPlayer.heridasBrazosPlayer == 2 ? "heridos gravemente. " : "heridos críticamente. "));
					if (_dataPlayer.heridasPiernasPlayer > 0)
						_txtPartes += "Tus piernas están " + String(_dataPlayer.heridasPiernasPlayer == 1 ? "heridas levemente. " : (_dataPlayer.heridasPiernasPlayer == 2 ? "heridas gravemente. " : "heridas críticamente. "));
					if (_txtPartes != "") $("#lisVisualField").append("<li>- "+String(_txtPartes)+"</li>");
					$("#lisVisualField").append("<li class='liInvisible'>.</li>");
					
					// Luego, para cada enemigo...
					for (let i = 0; i < _dataEnemies.length; ++i)
					{
						// Su descripción.
						let _txt = String(getEnemyDescription(_dataEnemies[i].nameEnemy));
						
						// El estado.
						_txt += getEnemyState(_dataEnemies[i].stateEnemy);
						
						// Sus heridas.
						let _txtPartes = "";
						if (_dataEnemies[i].heridasCabezaEnemy > 0)
							_txtPartes += "Su cabeza está " + String(_dataEnemies[i].heridasCabezaEnemy == 1 ? "herida levemente. " : (_dataEnemies[i].heridasCabezaEnemy == 2 ? "herida gravemente. " : "herida críticamente. "));
						if (_dataEnemies[i].heridasCuerpoEnemy > 0)
							_txtPartes += "Su cuerpo está " + String(_dataEnemies[i].heridasCuerpoEnemy == 1 ? "herido levemente. " : (_dataEnemies[i].heridasCuerpoEnemy == 2 ? "herido gravemente. " : "herido críticamente. "));
						if (_dataEnemies[i].heridasBrazosEnemy > 0)
							_txtPartes += "Sus brazos están " + String(_dataEnemies[i].heridasBrazosEnemy == 1 ? "heridos levemente. " : (_dataEnemies[i].heridasBrazosEnemy == 2 ? "heridos gravemente. " : "heridos críticamente. "));
						if (_dataEnemies[i].heridasPiernasEnemy > 0)
							_txtPartes += "Sus piernas están " + String(_dataEnemies[i].heridasPiernasEnemy == 1 ? "heridas levemente. " : (_dataEnemies[i].heridasPiernasEnemy == 2 ? "heridas gravemente. " : "heridas críticamente. "));
						if (_txtPartes != "") _txt += _txtPartes;
						
						// Añade el objetivo a la lista de visualizaciones.
						let _name = "Enemy"+String(i);
						$("#lisVisualField").append("<li><input type='radio' id='rbChooseEnemy"+String(i)+"' name='objectiveChosen' value='ChooseEnemy"+String(i)+"' class='rbChoose'><label for='rbChooseEnemy"+String(i)+"'>"+String(_txt)+"</label></li>");
						$("#rbChooseEnemy"+String(i)).change(_event => {
							chosenObjective = "enemy/"+String(i);
							enableAction();
						});
					}
					
					$("#lisVisualField").addClass("lisOpened");
					$(".rbChoose").removeAttr('disabled');
				});
			}
			if (true){ // ####################################################### Tale 01: obtén la descripción completa del enemigo para identificarlo (async). #######################################################
				function getEnemyDescription(_nameEnemy)
				{
					if (_nameEnemy == "ExploradorPala") return "Observas un explorador bien tapado con ropa de abrigo densa, a través de la cual puedes distinguir su fornida musculatura. Presenta ágiles movimientos y sus gritos te hacen notar su presencia, aunque está algo indeciso y su expresión no transmite estar muy enfocado en el asunto. Sujeta una pala con sus dos manos. ";
					else return ""
				}
				function getEnemyState(_stateEnemy)
				{
					if (_stateEnemy == "Aggressive") return "Su mirada está fija en ti y tiene intención de matarte. ";
					else return "";
				}
			}
			if (true){ // ####################################################### Scripts. #######################################################
				function tiendeAX(_val,_obj,_inc)
				{
					var _ret = _val;

					if ( _inc == 0 ) return _obj;

					if ( _ret < _obj ) _ret = Math.min( _ret + _inc, _obj );
					else _ret = Math.max( _ret - _inc, _obj );

					return _ret;
				}
				
				function dcos(_ang)
				{
					return Math.cos(_ang*Math.PI/180);
				}
				
				function dsin(_ang)
				{
					return Math.sin(_ang*Math.PI/180);
				}
				
				function pointDistance(_x1,_y1,_x2,_y2)
				{
					return Math.sqrt(Math.pow(_x1-_x2,2)+Math.pow(_y1-_y2,2));
				}
				
				function angular(_dir)
				{
					return (_dir%360 + 360)%360;
				}
				
				function pointDirection(_x1,_y1,_x2,_y2)
				{
					return angular(Math.atan2(-(_y2-_y1),_x2-_x1)*180/Math.PI);
				}
				
				function angleDifference(_a1,_a2)
				{
					var _diff = ( _a2 - _a1 + 180 ) % 360 - 180;
					return _diff < -180 ? _diff + 360 : _diff;
				}
			}
		</script>
	</body>
</html>
